#!/usr/bin/env node

/**
 * This script creates all possible permissions. Every permission can then be assigned
 * to some user via `assign-all-permissions` script.
 *
 * Useful in development.
 */

const _ = require('lodash/fp');
require('../src/applications/index');
const getPlan = require('../src/applications/plan').get;
const uuid = require('../src/uuid');
const qb = require('@imatic/pgqb');
const db = require('../src/db');

db.init();

const permissions = ['view', 'create', 'update', 'delete'];
const types = _.flatMap(_.keys, getPlan());

const columns = ['key', 'resourceType', 'permission'];

function typeToValues(type) {
    return _.map(
        (p) => _.map(qb.val.inlineParam, [uuid.generate(), type, p]),
        permissions
    );
}

const sqlMap = qb.merge(
    qb.insertInto('user.permissions'),
    qb.columns(columns),
    qb.values(_.flatMap(typeToValues, types))
);

db.query(qb.toSql(sqlMap));
